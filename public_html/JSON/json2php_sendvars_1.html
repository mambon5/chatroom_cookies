<!DOCTYPE html>
<html>
<body onload="senddata()">

<h2 id ="h2">Convert a JavaScript object into a JSON string, and send it to the server.</h2>

<button  onclick="undo()"> Stop moving </button>
<button  onclick="redo()"> Start moving </button>
<div id="obj"> Move it! mah babeh!</div>

<script>
var fes = true;
var pos = document.getElementById("obj");

aux1 = document.getElementById("h2");
var waitime = 300;
aux1.innerHTML = "waiting " + waitime/1000 + 
        " sec for calling the .php file.";
var xmlhttp = new XMLHttpRequest();

var myJSON = "";
var myObj = "";


//    aux1.innerHTML ="sending ...";
xmlhttp.onreadystatechange = function() {
  if (this.readyState == 4 && this.status == 200) {
    myObj = JSON.parse(this.responseText);
    
    aux1.innerHTML = "waiting " + waitime/1000 + " sec for calling the .php file";
    aux1.innerHTML += "<br>"+ myObj.name + " : " + myObj.age + " lives in " +
            myObj.city;
    myObj.age += 1;
    myJSON = JSON.stringify(myObj);
    move();
    
  }
};

    xmlhttp.open("GET", "phpData.txt", true);
    xmlhttp.send();
    
    
    function senddata() {
    
        setTimeout(function(){if(fes) {window.location = "../php/server/write2txt.php?y=" + myJSON; }}, waitime);
    }
    

function undo(){
    fes = false;
}

function redo(){
    fes = true;
    senddata();
}

function move() {
  
    pos.style.position = "absolute";
    pos.style.backgroundColor = "red";
    pos.style.left = myObj.age + "px";
    pos.innerHTML = "hola";
    
}
</script>

</body>
</html>
